From 1e294b5abf16a7fb5dae7a602f0ae506fb80ba7a Mon Sep 17 00:00:00 2001
From: Vivek Kumbhar <vkumbhar@mvista.com>
Date: Fri, 4 Aug 2023 09:40:39 +0000
Subject: [PATCH] CVE-2023-2603

---
 progs/setcap.c | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/progs/setcap.c b/progs/setcap.c
index 7304343..31feac4 100644
--- a/progs/setcap.c
+++ b/progs/setcap.c
@@ -4,6 +4,7 @@
  * This sets/verifies the capabilities of a given file.
  */

+#include <ctype.h>
 #include <errno.h>
 #include <stdio.h>
 #include <string.h>
@@ -99,6 +100,17 @@ int main(int argc, char **argv)
		text = *argv;
	    }

+	    int non_space = 0;
+	    for (int j = 0; text[j]; j++) {
+		if (!isspace(text[j])) {
+		    non_space = 1;
+		    break;
+		}
+	    }
+	    if (!non_space) {
+		fprintf(stderr, "empty space is an invalid capability, did you mean -r?\n");
+		exit(1);
+	    }
	    cap_d = cap_from_text(text);
	    if (cap_d == NULL) {
		perror("fatal error");
--
2.18.2
