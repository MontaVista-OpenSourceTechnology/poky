From 234dd7b89a1049d6ac2b69e12e48fbf0f58d51ac Mon Sep 17 00:00:00 2001
From: Vivek Kumbhar <vkumbhar@mvista.com>
Date: Tue, 22 Aug 2023 10:10:31 +0000
Subject: [PATCH] CVE-2023-28321

---
 lib/version.c | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

diff --git a/lib/version.c b/lib/version.c
index 1752e14..6f360f3 100644
--- a/lib/version.c
+++ b/lib/version.c
@@ -37,6 +37,14 @@
 #  include <ares.h>
 #endif

+#ifdef USE_LIBIDN
+#include <stringprep.h>
+#endif
+
+#ifdef USE_LIBIDN
+#include <stringprep.h>
+#endif
+
 #ifdef USE_LIBIDN2
 #include <idn2.h>
 #endif
@@ -211,6 +219,10 @@ char *curl_version(void)
 */
   }
 #endif
+#ifdef USE_LIBIDN
+  sprintf(ptr, " libidn/%s", stringprep_check_version(NULL));
+  ptr += strlen(ptr);
+#endif

   initialized = true;
   return version;
@@ -345,6 +357,9 @@ static curl_version_info_data version_info = {
     ( (SIZEOF_OFF_T > 4) || defined(USE_WIN32_LARGE_FILES) )
   | CURL_VERSION_LARGEFILE
 #endif
+#ifdef USE_LIBIDN
+  | CURL_VERSION_IDN
+#endif
 #if defined(CURL_DOES_CONVERSIONS)
   | CURL_VERSION_CONV
 #endif
--
2.18.2
