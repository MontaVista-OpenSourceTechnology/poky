From ae2dc830fb37e9243dbdaf8b92e41df91f43b3f2 Mon Sep 17 00:00:00 2001
From: Harry Sintonen <sintonen@iki.fi>
Date: Fri, 7 May 2021 13:09:57 +0200
Subject: [PATCH] telnet: check sscanf() for correct number of matches

CVE-2021-22898

Bug: https://curl.se/docs/CVE-2021-22898.html

Upstream-commit: 39ce47f219b09c380b81f89fe54ac586c8db6bde
Signed-off-by: Kamil Dudka <kdudka@redhat.com>
Upstream-Status: Backport
CVE: CVE-2021-22898
Signed-off-by: Armin Kuster <akuster@mvista.com>

---
 lib/telnet.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: curl-7.61.0/lib/telnet.c
===================================================================
--- curl-7.61.0.orig/lib/telnet.c
+++ curl-7.61.0/lib/telnet.c
@@ -971,7 +971,7 @@ static void suboption(struct connectdata
         size_t tmplen = (strlen(v->data) + 1);
         /* Add the variable only if it fits */
         if(len + tmplen < (int)sizeof(temp)-6) {
-          if(sscanf(v->data, "%127[^,],%127s", varname, varval)) {
+          if(sscanf(v->data, "%127[^,],%127s", varname, varval) == 2) {
             snprintf((char *)&temp[len], sizeof(temp) - len,
                      "%c%s%c%s", CURL_NEW_ENV_VAR, varname,
                      CURL_NEW_ENV_VALUE, varval);
