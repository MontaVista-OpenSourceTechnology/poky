From cc281c988e534132eda1000aab0c864422ecc379 Mon Sep 17 00:00:00 2001
From: Hitendra Prajapati <hprajapati@mvista.com>
Date: Fri, 19 Nov 2021 16:27:17 +0530
Subject: [PATCH] CVE-2021-43618

Upstream-Status: Backport from https://gmplib.org/repo/gmp-6.2/rev/561a9c25298e

Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 mpz/inp_raw.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/mpz/inp_raw.c b/mpz/inp_raw.c
index b7994a3..54f6d12 100644
--- a/mpz/inp_raw.c
+++ b/mpz/inp_raw.c
@@ -89,8 +89,11 @@ mpz_inp_raw (mpz_ptr x, FILE *fp)
 
   abs_csize = ABS (csize);
 
+  if (UNLIKELY (abs_csize > ~(mp_bitcnt_t) 0 / 8))
+    return 0; /* Bit size overflows */
+
   /* round up to a multiple of limbs */
-  abs_xsize = BITS_TO_LIMBS (abs_csize*8);
+  abs_xsize = BITS_TO_LIMBS ((mp_bitcnt_t) abs_csize * 8);
 
   if (abs_xsize != 0)
     {
-- 
2.25.1

