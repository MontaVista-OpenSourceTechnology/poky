From 3f631bc96882d538d7fce41e397c5b439a7f05a0 Mon Sep 17 00:00:00 2001
From: Craig Disselkoen <cdisselk@cs.ucsd.edu>
Date: Tue, 19 Nov 2019 18:56:26 +0000
Subject: [PATCH] Bug 1586176 - EncryptUpdate should use maxout not block size. r=franziskus

Upstream-Status: Backport [https://hg-edge.mozilla.org/projects/nss/rev/1e22a0c93afe9f46545560c86caedef9dab6cfda]
CVE: CVE-2019-11745
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 nss/lib/softoken/pkcs11c.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/nss/lib/softoken/pkcs11c.c b/nss/lib/softoken/pkcs11c.c
index e290495..7451557 100644
--- a/nss/lib/softoken/pkcs11c.c
+++ b/nss/lib/softoken/pkcs11c.c
@@ -1288,7 +1288,7 @@ NSC_EncryptUpdate(CK_SESSION_HANDLE hSession,
             }
             /* encrypt the current padded data */
             rv = (*context->update)(context->cipherInfo, pEncryptedPart,
-                                    &padoutlen, context->blockSize, context->padBuf,
+                                    &padoutlen, maxout, context->padBuf,
                                     context->blockSize);
             if (rv != SECSuccess) {
                 return sftk_MapCryptError(PORT_GetError());
-- 
2.18.2

