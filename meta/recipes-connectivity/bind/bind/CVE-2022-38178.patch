From 7c0028cfad2ae5fdf82c4d02d3b8b3a1e96dc6ec Mon Sep 17 00:00:00 2001
From: Mark Andrews <marka@isc.org>
Date: Thu, 11 Aug 2022 15:28:13 +1000
Subject: [PATCH] Free ctx on invalid siglen

(cherry picked from commit 6ddb480a84836641a0711768a94122972c166825)

Upstream-Status: Backport
CVE: CVE-2022-38178
Signed-off-by: Armin Kuster <akuster@mvista.com>

---
 lib/dns/openssleddsa_link.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

Index: bind-9.11.37/lib/dns/openssleddsa_link.c
===================================================================
--- bind-9.11.37.orig/lib/dns/openssleddsa_link.c
+++ bind-9.11.37/lib/dns/openssleddsa_link.c
@@ -325,7 +325,7 @@ openssleddsa_verify(dst_context_t *dctx,
 		siglen = DNS_SIG_ED448SIZE;
 
 	if (sig->length != siglen)
-		return (DST_R_VERIFYFAILURE);
+		DST_RET (DST_R_VERIFYFAILURE);
 
 	isc_buffer_usedregion(buf, &tbsreg);
 
