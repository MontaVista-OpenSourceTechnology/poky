From 887f072ce70a0861640f8accc6cd96e552c45c65 Mon Sep 17 00:00:00 2001
From: Simon Josefsson <simon@josefsson.org>
Date: Wed, 1 Jan 2020 15:28:54 +0100
Subject: telnet: Validate supplied environment variables.
 CVE-2019-0053

telnet/telnet.c (suboption): Use snprintf instead of sprintf.
telnet/utilities.c (printsub): Likewise.
---
 ChangeLog          | 6 ++++++
 telnet/telnet.c    | 6 +++---
 telnet/utilities.c | 2 +-
 3 files changed, 10 insertions(+), 4 deletions(-)

This fixes CVE-2019-0053. Patch #2.

Signed-off-by: Javier Campos <jcampos@mvista.com>

Index: inetutils-1.9.4/ChangeLog
===================================================================
--- inetutils-1.9.4.orig/ChangeLog
+++ inetutils-1.9.4/ChangeLog
@@ -1,5 +1,11 @@
 2020-01-01  Simon Josefsson  <simon@josefsson.org>
 
+	telnet: Validate supplied environment variables. CVE-2019-0053
+	* telnet/telnet.c (suboption): Use snprintf instead of sprintf.
+	* telnet/utilities.c (printsub): Likewise.
+
+2020-01-01  Simon Josefsson  <simon@josefsson.org>
+
 	* telnet/telnet.c (telsnd): Telnet -E(no escape) is treating
 	_POSIX_VDISABLE char as escape.
 	Reported by Mikhail Bychek <mikhail.bychek@sputnix.ru>.
Index: inetutils-1.9.4/telnet/telnet.c
===================================================================
--- inetutils-1.9.4.orig/telnet/telnet.c
+++ inetutils-1.9.4/telnet/telnet.c
@@ -861,7 +861,7 @@ suboption (void)
 	  len = strlen (name) + 4 + 2;
 	  if (len < NETROOM ())
 	    {
-	      sprintf ((char *) temp, "%c%c%c%c%s%c%c", IAC, SB, TELOPT_TTYPE,
+	      snprintf ((char *) temp, sizeof (temp), "%c%c%c%c%s%c%c", IAC, SB, TELOPT_TTYPE,
 		       TELQUAL_IS, name, IAC, SE);
 	      ring_supply_data (&netoring, temp, len);
 	      printsub ('>', &temp[2], len - 2);
@@ -885,7 +885,7 @@ suboption (void)
 
 	  TerminalSpeeds (&ispeed, &ospeed);
 
-	  sprintf ((char *) temp, "%c%c%c%c%d,%d%c%c", IAC, SB, TELOPT_TSPEED,
+	  snprintf ((char *) temp, sizeof (temp), "%c%c%c%c%d,%d%c%c", IAC, SB, TELOPT_TSPEED,
 		   TELQUAL_IS, (int) ospeed, (int) ispeed, IAC, SE);
 	  len = strlen ((char *) temp + 4) + 4;	/* temp[3] is 0 ... */
 
@@ -999,7 +999,7 @@ suboption (void)
 	      send_wont (TELOPT_XDISPLOC, 1);
 	      break;
 	    }
-	  sprintf ((char *) temp, "%c%c%c%c%s%c%c", IAC, SB, TELOPT_XDISPLOC,
+	  snprintf ((char *) temp, sizeof (temp), "%c%c%c%c%s%c%c", IAC, SB, TELOPT_XDISPLOC,
 		   TELQUAL_IS, dp, IAC, SE);
 	  len = strlen ((char *) temp + 4) + 4;	/* temp[3] is 0 ... */
 
Index: inetutils-1.9.4/telnet/utilities.c
===================================================================
--- inetutils-1.9.4.orig/telnet/utilities.c
+++ inetutils-1.9.4/telnet/utilities.c
@@ -732,7 +732,7 @@ printsub (char direction, unsigned char
 	      {
 		char tbuf[64];
 
-		sprintf (tbuf, "%s%s%s%s%s",
+		snprintf (tbuf, sizeof (tbuf), "%s%s%s%s%s",
 			 pointer[2] & MODE_EDIT ? "|EDIT" : "",
 			 pointer[2] & MODE_TRAPSIG ? "|TRAPSIG" : "",
 			 pointer[2] & MODE_SOFT_TAB ? "|SOFT_TAB" : "",
