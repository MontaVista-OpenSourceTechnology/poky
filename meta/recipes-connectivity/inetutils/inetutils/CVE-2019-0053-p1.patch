From cd3eba864066c7382148d04fce18778ff77f87ea Mon Sep 17 00:00:00 2001
From: Simon Josefsson <simon@josefsson.org>
Date: Wed, 1 Jan 2020 12:38:52 +0100
Subject: telnet: Telnet -E(no escape) is treating  _POSIX_VDISABLE
 char as escape.

Reported by Mikhail Bychek <mikhail.bychek@sputnix.ru>.

See also:
https://github.com/freebsd/freebsd/commit/c3694d985891efb8a156e933600d23132577a053
https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=6317
---
 ChangeLog       | 6 ++++++
 telnet/telnet.c | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

This fixes CVE-2019-0053. Patch #1.

Signed-off-by: Javier Campos <jcampos@mvista.com>

Index: inetutils-1.9.4/ChangeLog
===================================================================
--- inetutils-1.9.4.orig/ChangeLog
+++ inetutils-1.9.4/ChangeLog
@@ -1,3 +1,9 @@
+2020-01-01  Simon Josefsson  <simon@josefsson.org>
+
+	* telnet/telnet.c (telsnd): Telnet -E(no escape) is treating
+	_POSIX_VDISABLE char as escape.
+	Reported by Mikhail Bychek <mikhail.bychek@sputnix.ru>.
+
 2015-05-27  Alfred M. Szmidt  <ams@gnu.org>
 
 	* Makefile.am (ACLOCAL_AMFLAGS): New variable.
Index: inetutils-1.9.4/telnet/telnet.c
===================================================================
--- inetutils-1.9.4.orig/telnet/telnet.c
+++ inetutils-1.9.4/telnet/telnet.c
@@ -2223,7 +2223,7 @@ telsnd (void)
 	  if ((sc == '\n') || (sc == '\r'))
 	    bol = 1;
 	}
-      else if (sc == escape)
+	else if (escape != _POSIX_VDISABLE && sc == escape)
 	{
 	  /*
 	   * Double escape is a pass through of a single escape character.
