From e10a3a84bf73a3e6024c338b51f2fb4e78a3dee9 Mon Sep 17 00:00:00 2001
From: Matt Caswell <matt@openssl.org>
Date: Fri, 21 Jun 2024 10:41:55 +0100
Subject: [PATCH] CVE-2024-5535_6: Correct return values for tls_construct_stoc_next_proto_neg

Upstream-Status: Backport from https://github.com/openssl/openssl/commit/e10a3a84bf73a3e6024c338b51f2fb4e78a3dee9
CVE: CVE-2024-5535

Signed-off-by: Rohini Sangam <rsangam@mvista.com>
---
 .../1.1.1w-r0.2.1/openssl-1.1.1w/ssl/statem/extensions_srvr.c  | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/ssl/statem/extensions_srvr.c b/ssl/statem/extensions_srvr.c
index 4754110..311d7f8 100644
--- a/ssl/statem/extensions_srvr.c
+++ b/ssl/statem/extensions_srvr.c
@@ -1558,9 +1558,10 @@ EXT_RETURN tls_construct_stoc_next_proto_neg(SSL *s, WPACKET *pkt,
             return EXT_RETURN_FAIL;
         }
         s->s3->npn_seen = 1;
+	return EXT_RETURN_SENT;
     }
 
-    return EXT_RETURN_SENT;
+    return EXT_RETURN_NOT_SENT;
 }
 #endif
 
-- 
2.24.4

