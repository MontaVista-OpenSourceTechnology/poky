From 07e917fcff9682b0e9dbd93bff9d701efeae0e8c Mon Sep 17 00:00:00 2001
From: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Date: Tue, 3 Oct 2017 13:55:07 +0300
Subject: [PATCH 05/12] gatt: Fix not sending indications properly

When using AcquireNotify with notifications the code would assume that
notification would always be used instead of checking if indications are
supported.

Upstream Status: Backport [patch #5]
CVE: CVE-2021-43400
Signed-off-by: Sunil Kumar <sukumar@mvista.com>

Signed-off-by: Sunil Kumar <sukumar@mvista.com>
---
 src/gatt-database.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/gatt-database.c b/src/gatt-database.c
index 45fc2b2..93d6cf7 100644
--- a/src/gatt-database.c
+++ b/src/gatt-database.c
@@ -1874,7 +1874,8 @@ static bool pipe_io_read(struct io *io, void *user_data)
 				gatt_db_attribute_get_handle(chrc->attrib),
 				buf, bytes_read,
 				gatt_db_attribute_get_handle(chrc->ccc),
-				false, NULL);
+				chrc->props & BT_GATT_CHRC_PROP_INDICATE,
+				NULL);
 
 	return true;
 }
-- 
2.7.4

