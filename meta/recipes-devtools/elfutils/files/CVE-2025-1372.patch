From 2074472647d4e81492e903dcf5b397cc350d70a0 Mon Sep 17 00:00:00 2001
From: Milan Satpathy <msatpathy@mvista.com>
Date: Tue, 5 Aug 2025 17:22:05 +0530
Subject: [PATCH] From:   73db9d2021cab9e23fd734b0a76a612d52a6f1db Author: Mark
 Wielaard <mark@klomp.org> Date:   Sun Feb 9 00:07:39 2025 +0100

    readelf: Skip trying to uncompress sections without a name

    When combining eu-readelf -z with -x or -p to dump the data or strings
    in an (corrupted ELF) unnamed numbered section eu-readelf could crash
    trying to check whether the section name starts with .zdebug. Fix this
    by skipping sections without a name.

       * src/readelf.c (dump_data_section): Don't try to gnu decompress a
       section without a name.
       (print_string_section): Likewise.

    https://sourceware.org/bugzilla/show_bug.cgi?id=32656

    Signed-off-by: Mark Wielaard <mark@klomp.org>

Upstream-Status: Backport from [https://sourceware.org/git/?p=elfutils.git;a=commit;h=73db9d2021cab9e23fd734b0a76a612d52a6f1db]
CVE: 173721
Signed-off-by: Milan Satpathy <msatpathy@mvista.com>
---
 src/readelf.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/readelf.c b/src/readelf.c
index ab7a1c1..008e6d1 100644
--- a/src/readelf.c
+++ b/src/readelf.c
@@ -12526,7 +12526,7 @@ dump_data_section (Elf_Scn *scn, const GElf_Shdr *shdr, const char *name)
 			gettext ("Couldn't uncompress section"),
 			elf_ndxscn (scn));
 	    }
-	  else if (strncmp (name, ".zdebug", strlen (".zdebug")) == 0)
+	  else if (name && strncmp (name, ".zdebug", strlen (".zdebug")) == 0)
 	    {
 	      if (elf_compress_gnu (scn, 0, 0) < 0)
 		printf ("WARNING: %s [%zd]\n",
@@ -12577,7 +12577,7 @@ print_string_section (Elf_Scn *scn, const GElf_Shdr *shdr, const char *name)
 			gettext ("Couldn't uncompress section"),
 			elf_ndxscn (scn));
 	    }
-	  else if (strncmp (name, ".zdebug", strlen (".zdebug")) == 0)
+	  else if (name && strncmp (name, ".zdebug", strlen (".zdebug")) == 0)
 	    {
 	      if (elf_compress_gnu (scn, 0, 0) < 0)
 		printf ("WARNING: %s [%zd]\n",
-- 
2.34.1

