From fc2cc270513357ae18d2fff7520164d7386b4a51 Mon Sep 17 00:00:00 2001
From: Vijay Anusuri <vanusuri@mvista.com>
Date: Tue, 18 Oct 2022 10:58:50 +0000
Subject: [PATCH] net/url: use EscapedPath for url.JoinPath

Fixes #53763

Change-Id: I08b53f159ebdce7907e8cc17316fd0c982363239
Reviewed-on: https://go-review.googlesource.com/c/go/+/416774
TryBot-Result: Gopher Robot <gobot@golang.org>
Reviewed-by: Damien Neil <dneil@google.com>
Reviewed-by: Bryan Mills <bcmills@google.com>
Run-TryBot: Ian Lance Taylor <iant@golang.org>

Upstream-Status: Backport [https://github.com/golang/go/commit/bf5898ef53d1693aa572da0da746c05e9a6f15c5]
CVE: CVE-2022-32190
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 src/net/url/url.go | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/net/url/url.go b/src/net/url/url.go
index 563bff7..263707b 100644
--- a/src/net/url/url.go
+++ b/src/net/url/url.go
@@ -1066,7 +1066,7 @@ func (u *URL) UnmarshalBinary(text []byte) error {
 func (u *URL) JoinPath(elem ...string) *URL {
       url := *u
       if len(elem) > 0 {
-              elem = append([]string{u.Path}, elem...)
+              elem = append([]string{u.EscapedPath()}, elem...)
               p := path.Join(elem...)
               // path.Join will remove any trailing slashes.
               // Preserve at least one.
-- 
2.18.2

