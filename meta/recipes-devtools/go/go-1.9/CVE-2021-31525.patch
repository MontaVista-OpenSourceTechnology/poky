From b1545615e47dc4ddff477e100841e958a0d5af04 Mon Sep 17 00:00:00 2001
From: Vijay Anusuri <vanusuri@mvista.com>
Date: Thu, 13 Oct 2022 03:16:21 +0000
Subject: [PATCH] CVE-2021-31525

Upstream-Status: Backport [https://github.com/golang/go/commit/5aed4ce3c854bdbbb6dd5c1ccfa15c23d4b6c989]
CVE: CVE-2021-31525
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 src/vendor/golang_org/x/net/lex/httplex/httplex.go | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/src/vendor/golang_org/x/net/lex/httplex/httplex.go b/src/vendor/golang_org/x/net/lex/httplex/httplex.go
index b6493f0..ffe47e4 100644
--- a/src/vendor/golang_org/x/net/lex/httplex/httplex.go
+++ b/src/vendor/golang_org/x/net/lex/httplex/httplex.go
@@ -142,11 +142,13 @@ func trimOWS(x string) string {
 // contains token amongst its comma-separated tokens, ASCII
 // case-insensitively.
 func headerValueContainsToken(v string, token string) bool {
-	v = trimOWS(v)
-	if comma := strings.IndexByte(v, ','); comma != -1 {
-		return tokenEqual(trimOWS(v[:comma]), token) || headerValueContainsToken(v[comma+1:], token)
+      for comma := strings.IndexByte(v, ','); comma != -1; comma = strings.IndexByte(v, ',') {
+              if tokenEqual(trimOWS(v[:comma]), token) {
+                      return true
+              }
+              v = v[comma+1:]
 	}
-	return tokenEqual(v, token)
+        return tokenEqual(trimOWS(v), token)
 }
 
 // lowerASCII returns the ASCII lowercase version of b.
-- 
2.18.2

