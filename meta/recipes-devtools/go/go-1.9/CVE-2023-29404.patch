From 68ecfa912e36445b163a4a9ba6cc8fa78b3b5fcb Mon Sep 17 00:00:00 2001
From: Vivek Kumbhar <vkumbhar@mvista.com>
Date: Tue, 31 Oct 2023 03:36:26 +0000
Subject: [PATCH] CVE-2023-29404

---
 src/cmd/go/internal/work/security.go      | 4 +++-
 src/cmd/go/internal/work/security_test.go | 5 +++++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/cmd/go/internal/work/security.go b/src/cmd/go/internal/work/security.go
index 4419fec..a94e72d 100644
--- a/src/cmd/go/internal/work/security.go
+++ b/src/cmd/go/internal/work/security.go
@@ -90,7 +90,9 @@ var validLinkerFlags = []*regexp.Regexp{
	// linker arguments through one of these.
	re(`-Wl,-rpath,([^,@\-][^,]+)`),
	re(`-Wl,--(no-)?warn-([^,]+)`),
-
+        re(`-Wl,-O[0-9]+`),
+        re(`-Wl,-e[=,][a-zA-Z0-9]+`),
+        re(`-Wl,-R,?([^@\-,][^,@]*$)`),
	re(`[a-zA-Z0-9_].*\.(o|obj|dll|dylib|so)`), // direct linker inputs: x.o or libfoo.so (but not -foo.o or @foo.o)
 }

diff --git a/src/cmd/go/internal/work/security_test.go b/src/cmd/go/internal/work/security_test.go
index 8f95704..c78ad2a 100644
--- a/src/cmd/go/internal/work/security_test.go
+++ b/src/cmd/go/internal/work/security_test.go
@@ -98,6 +98,11 @@ var badCompilerFlags = [][]string{
	{"-framework", "@Home"},
	{"-x", "--c"},
	{"-x", "@obj"},
+        {"-Wl,-R,"},
+	{"-Wl,-O"},
+	{"-Wl,-e="},
+	{"-Wl,-e,"},
+	{"-Wl,-R,-flag"},
 }

 func TestCheckCompilerFlags(t *testing.T) {
--
2.18.2
