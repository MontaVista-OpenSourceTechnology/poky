From 1d4d51cfcb0339f4cce5bb467261dbde41eac333 Mon Sep 17 00:00:00 2001
From: Vijay Anusuri <vanusuri@mvista.com>
Date: Wed, 25 Jan 2023 04:18:42 +0000
Subject: [PATCH] Fix a illegal memory access fault when parsing a corrupt MIPS option section using readelf.

PR 24243
* readelf.c (process_mips_specific): Check for an options section
that is too small to even contain a single option.

Upstream-Status: Backport [https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=7fc0c668f2aceb8582d74db1ad2528e2bba8a921]
CVE: CVE-2019-9077
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 binutils/readelf.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/binutils/readelf.c b/binutils/readelf.c
index 4ad20b319e3..320bf70d2ee 100644
--- a/binutils/readelf.c
+++ b/binutils/readelf.c
@@ -15469,6 +15469,12 @@ process_mips_specific (FILE * file)
 	  error (_("No MIPS_OPTIONS header found\n"));
 	  return FALSE;
 	}
+      /* PR 24243  */
+      if (sect->sh_size < sizeof (* eopt))
+       {
+         error (_("The MIPS options section is too small.\n"));
+         return FALSE;
+       }
 
       eopt = (Elf_External_Options *) get_data (NULL, file, options_offset, 1,
                                                 sect->sh_size, _("options"));
-- 
2.18.2

