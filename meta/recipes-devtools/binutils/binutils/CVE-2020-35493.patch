From 3fa99caa8c6fa5d4c75d0d0fdf0648c2c274d556 Mon Sep 17 00:00:00 2001
From: Nick Clifton <nickc@redhat.com>
Date: Fri, 3 Jan 2020 16:17:53 +0000
Subject: [PATCH] Fix potential illegal memory access when parsing a corrupt
 PEF format file.

	PR 25307
	(bfd_pef_parse_function_stubs): Correct the test that ensures that
	there is enough data remaining in the code buffer before
	attempting to read a function stub.

Upstream-Status: Backport from https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=f2a3559d54602cecfec6d90f792be4a70ad918ab
CVE: CVE-2020-35493
Signed-off-by: Hardik Gohil <hgohil@mvista.com>
---
 bfd/pef.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/bfd/pef.c b/bfd/pef.c
index 7f03d17..258f8f4 100644
--- a/bfd/pef.c
+++ b/bfd/pef.c
@@ -796,7 +796,7 @@ bfd_pef_parse_function_stubs (bfd *abfd,
 	  codepos += 4;
 	}
 
-      if ((codepos + 4) > codelen)
+      if ((codepos + 24) > codelen)
 	break;
 
       ret = bfd_pef_parse_function_stub (abfd, codebuf + codepos, 24, &sym_index);
-- 
2.7.4

