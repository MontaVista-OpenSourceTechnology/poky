Origin: backport, https://sourceware.org/git/?p=binutils-gdb.git;a=patch;h=4fd8d5856435ff84de1f181381fc51754285af6f

From 4fd8d5856435ff84de1f181381fc51754285af6f Mon Sep 17 00:00:00 2001
From: Nick Clifton <nickc@redhat.com>
Date: Wed, 15 Jul 2020 11:09:59 +0100
Subject: [PATCH] Fix an illegal memory access in the BFD library which can be
 triggered by attempting to parse a corrupt PE format file.

	PR26240
	* coffgen.c (coff_get_normalized_symtab): Fix off-by-one error in
	check for aux entries that overflow the buufer.

Upstream-Status: Backport [import from ubuntu https://git.launchpad.net/ubuntu/+source/binutils/tree/debian/patches/CVE-2020-19726-2.patch?h=ubuntu/focal-security
Upstream commit https://sourceware.org/git/?p=binutils-gdb.git;a=patch;h=4fd8d5856435ff84de1f181381fc51754285af6f]
CVE: CVE-2020-19726
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 bfd/ChangeLog | 6 ++++++
 bfd/coffgen.c | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

Index: binutils-2.34/bfd/coffgen.c
===================================================================
--- binutils-2.34.orig/bfd/coffgen.c
+++ binutils-2.34/bfd/coffgen.c
@@ -1852,7 +1852,7 @@ coff_get_normalized_symtab (bfd *abfd)
       internal_ptr->is_sym = TRUE;
 
       /* PR 17512: Prevent buffer overrun.  */
-      if (symbol_ptr->u.syment.n_numaux > (raw_end - raw_src) / symesz)
+      if (symbol_ptr->u.syment.n_numaux > ((raw_end - 1) - raw_src) / symesz)
 	{
 	  bfd_release (abfd, internal);
 	  return NULL;
