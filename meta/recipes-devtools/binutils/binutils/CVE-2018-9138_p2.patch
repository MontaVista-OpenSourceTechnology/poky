From 62de0a336a43c758a11606fc9e8ee74bd2bc3cd0 Mon Sep 17 00:00:00 2001
From: Nick Clifton <nickc@redhat.com>
Date: Tue, 11 Dec 2018 12:01:15 +0000
Subject: [PATCH 3/4] Fix a failure in the libiberty testsuite by increasing
 the recursion limit to 2048.

	PR 88409
include	* demangle.h (DEMANGLE_RECURSION_LIMIT): Increase to 2048.

binutils* NEWS: Note that recursion limit has increased to 2048.
	* doc/binutils.texi: Likewise.

Upstream-Status: Backport [https://sourceware.org/git/?p=binutils-gdb.git;a=commit;h=69799d67e8872dcd3feee81ed2ff0fc47beb52d7]
CVE: CVE-2018-9138
Signed-off-by: E V Ravi <reluri@mvista.com>

%% original patch: 0001-Fix-a-failure-in-the-libiberty-testsuite-by-increasi.patch
---
 binutils/NEWS              | 2 +-
 binutils/doc/binutils.texi | 8 ++++----
 include/ChangeLog          | 5 +++++
 include/demangle.h         | 2 +-
 4 files changed, 11 insertions(+), 6 deletions(-)

diff --git a/binutils/NEWS b/binutils/NEWS
index c18abb7..a0ca39a 100644
--- a/binutils/NEWS
+++ b/binutils/NEWS
@@ -4,7 +4,7 @@
   maximum amount of recursion that is allowed whilst demangling strings.
   The value for this limit is defined by the DEMANGLE_RECRUSE_LIMIT
   constant declared in the include/demangle.h header file.  At the time
-  of writing this constant has the value of 1024.
+  of writing this constant has the value of 2048.
 
   The --no-recurse-limit option can be used to remove the limit, restoring
   the behaviour of earlier versions of these tools.  This may be needed in
diff --git a/binutils/doc/binutils.texi b/binutils/doc/binutils.texi
index f19c52f..ea8196b 100644
--- a/binutils/doc/binutils.texi
+++ b/binutils/doc/binutils.texi
@@ -946,7 +946,7 @@ whilst demangling strings.  Since the name mangling formats allow for
 an inifinite level of recursion it is possible to create strings whose
 decoding will exhaust the amount of stack space available on the host
 machine, triggering a memory fault.  The limit tries to prevent this
-from happening by restricting recursion to 1024 levels of nesting.
+from happening by restricting recursion to 2048 levels of nesting.
 
 The default is for this limit to be enabled, but disabling it may be
 necessary in order to demangle truly complicated names.  Note however
@@ -2192,7 +2192,7 @@ whilst demangling strings.  Since the name mangling formats allow for
 an inifinite level of recursion it is possible to create strings whose
 decoding will exhaust the amount of stack space available on the host
 machine, triggering a memory fault.  The limit tries to prevent this
-from happening by restricting recursion to 1024 levels of nesting.
+from happening by restricting recursion to 2048 levels of nesting.
 
 The default is for this limit to be enabled, but disabling it may be
 necessary in order to demangle truly complicated names.  Note however
@@ -3569,7 +3569,7 @@ whilst demangling strings.  Since the name mangling formats allow for
 an inifinite level of recursion it is possible to create strings whose
 decoding will exhaust the amount of stack space available on the host
 machine, triggering a memory fault.  The limit tries to prevent this
-from happening by restricting recursion to 1024 levels of nesting.
+from happening by restricting recursion to 2048 levels of nesting.
 
 The default is for this limit to be enabled, but disabling it may be
 necessary in order to demangle truly complicated names.  Note however
@@ -3792,7 +3792,7 @@ whilst demangling strings.  Since the name mangling formats allow for
 an inifinite level of recursion it is possible to create strings whose
 decoding will exhaust the amount of stack space available on the host
 machine, triggering a memory fault.  The limit tries to prevent this
-from happening by restricting recursion to 1024 levels of nesting.
+from happening by restricting recursion to 2048 levels of nesting.
 
 The default is for this limit to be enabled, but disabling it may be
 necessary in order to demangle truly complicated names.  Note however
diff --git a/include/ChangeLog b/include/ChangeLog
index bc6e98a..a00d094 100644
--- a/include/ChangeLog
+++ b/include/ChangeLog
@@ -1,3 +1,8 @@
+2018-12-11  Nick Clifton  <nickc@redhat.com>
+
+	PR 88409
+	* demangle.h (DEMANGLE_RECURSION_LIMIT): Increase to 2048.
+
 2018-12-07  Nick Clifton  <nickc@redhat.com>
 
 	* demangle.h (DMGL_NO_RECURSE_LIMIT): Define.
diff --git a/include/demangle.h b/include/demangle.h
index 2a15567..fd0e925 100644
--- a/include/demangle.h
+++ b/include/demangle.h
@@ -77,7 +77,7 @@ extern "C" {
 /* If DMGL_NO_RECURSE_LIMIT is not enabled, then this is the value used as
    the maximum depth of recursion allowed.  It should be enough for any
    real-world mangled name.  */
-#define DEMANGLE_RECURSION_LIMIT 1024
+#define DEMANGLE_RECURSION_LIMIT 2048
   
 /* Enumeration of possible demangling styles.
 
-- 
2.7.4

