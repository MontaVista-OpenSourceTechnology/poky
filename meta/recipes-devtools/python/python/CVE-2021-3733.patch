 bpo-43075: Fix ReDoS in urllib AbstractBasicAuthHandler (GH-24391) (GH-25250)

 Fix Regular Expression Denial of Service (ReDoS) vulnerability in
 urllib.request.AbstractBasicAuthHandler. The ReDoS-vulnerable regex
 has quadratic worst-case complexity and it allows cause a denial of
 service when identifying crafted invalid RFCs. This ReDoS issue is on
 the client side and needs remote attackers to control the HTTP server.
 (cherry picked from commit 7215d1a)

Co-authored-by: Yeting Li <liyt@ios.ac.cn>

Upstream-Status: Backport
Fixup for python2 context
CVE: CVE-2021-3733
Signed-off-by: Armin Kuster <akuster@mvista.com>

Index: Python-2.7.17/Lib/urllib2.py
===================================================================
--- Python-2.7.17.orig/Lib/urllib2.py
+++ Python-2.7.17/Lib/urllib2.py
@@ -856,7 +856,7 @@ class AbstractBasicAuthHandler:
 
     # allow for double- and single-quoted realm values
     # (single quotes are a violation of the RFC, but appear in the wild)
-    rx = re.compile('(?:.*,)*[ \t]*([^ \t]+)[ \t]+'
+    rx = re.compile('(?:.*,)*[ \t]*([^ \t,]+)[ \t]+'
                     'realm=(["\']?)([^"\']*)\\2', re.I)
 
     # XXX could pre-emptively send auth info already accepted (RFC 2617,
