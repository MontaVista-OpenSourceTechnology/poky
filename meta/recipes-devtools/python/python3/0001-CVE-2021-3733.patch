From 7c772db0be482b2324b5fcbf0eff1f670f555230 Mon Sep 17 00:00:00 2001
From: Vijay Anusuri <vanusuri@mvista.com>
Date: Mon, 8 Aug 2022 09:39:17 +0000
Subject: [PATCH] CVE-2021-3733

Fix ReDoS in urllib AbstractBasicAuthHandler

Upstream-Status: Backport from https://github.com/python/cpython/commit/7215d1ae25525c92b026166f9d5cac85fb1defe1
CVE: CVE-2021-3733
Co-authored-by: Yeting Li <liyt@ios.ac.cn>
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 Lib/urllib/request.py                                           | 2 +-
 .../next/Security/2021-01-31-05-28-14.bpo-43075.DoAXqO.rst      | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)
 create mode 100644 Misc/NEWS.d/next/Security/2021-01-31-05-28-14.bpo-43075.DoAXqO.rst

diff --git a/Lib/urllib/request.py b/Lib/urllib/request.py
index ae3fd0d..5153d5b 100644
--- a/Lib/urllib/request.py
+++ b/Lib/urllib/request.py
@@ -887,7 +887,7 @@ class AbstractBasicAuthHandler:
     # (single quotes are a violation of the RFC, but appear in the wild)
     rx = re.compile('(?:^|,)'   # start of the string or ','
                     '[ \t]*'    # optional whitespaces
-                    '([^ \t]+)' # scheme like "Basic"
+                    '([^ \t,]+)' # scheme like "Basic"
                     '[ \t]+'    # mandatory whitespaces
                     # realm=xxx
                     # realm='xxx'
diff --git a/Misc/NEWS.d/next/Security/2021-01-31-05-28-14.bpo-43075.DoAXqO.rst b/Misc/NEWS.d/next/Security/2021-01-31-05-28-14.bpo-43075.DoAXqO.rst
new file mode 100644
index 0000000..1c9f727
--- /dev/null
+++ b/Misc/NEWS.d/next/Security/2021-01-31-05-28-14.bpo-43075.DoAXqO.rst
@@ -0,0 +1 @@
+Fix Regular Expression Denial of Service (ReDoS) vulnerability in :class:`urllib.request.AbstractBasicAuthHandler`.  The ReDoS-vulnerable regex has quadratic worst-case complexity and it allows cause a denial of service when identifying crafted invalid RFCs. This ReDoS issue is on the client side and needs remote attackers to control the HTTP server.
-- 
2.18.2

