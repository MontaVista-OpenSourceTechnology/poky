From 496336be90083f7c32c2d3c0c40d6f40fc2c1d22 Mon Sep 17 00:00:00 2001
From: Sebastian Pipping <sebastian@pipping.org>
Date: Thu, 2 Jan 2025 13:54:38 +0100
Subject: [PATCH] gh-126624: Expose error code ``XML_ERROR_NOT_STARTED`` of
 Expat >=2.6.4 (#126625)
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Expose error code ``XML_ERROR_NOT_STARTED`` in `xml.parsers.expat.errors` which was
introduced in Expat 2.6.4.

Co-authored-by: Bénédikt Tran <10796600+picnixz@users.noreply.github.com>

Upstream-Status: Backport [https://github.com/python/cpython/commit/496336be90083f7c32c2d3c0c40d6f40fc2c1d22]
CVE: CVE-2024-50602
Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 Doc/library/pyexpat.rst                                    | 7 +++++++
 .../Library/2024-11-09-15-59-51.gh-issue-126624.bN53Va.rst | 2 ++
 Modules/pyexpat.c                                          | 2 ++
 3 files changed, 11 insertions(+)
 create mode 100644 Misc/NEWS.d/next/Library/2024-11-09-15-59-51.gh-issue-126624.bN53Va.rst

diff --git a/Doc/library/pyexpat.rst b/Doc/library/pyexpat.rst
index 09b532b..d567452 100644
--- a/Doc/library/pyexpat.rst
+++ b/Doc/library/pyexpat.rst
@@ -903,6 +903,13 @@ The ``errors`` module has the following attributes:
 .. data:: XML_ERROR_SUSPEND_PE
 
 
+.. data:: XML_ERROR_NOT_STARTED
+
+   The parser was tried to be stopped or suspended before it started.
+
+   .. versionadded:: next
+
+
 .. rubric:: Footnotes
 
 .. [1] The encoding string included in XML output should conform to the
diff --git a/Misc/NEWS.d/next/Library/2024-11-09-15-59-51.gh-issue-126624.bN53Va.rst b/Misc/NEWS.d/next/Library/2024-11-09-15-59-51.gh-issue-126624.bN53Va.rst
new file mode 100644
index 0000000..468840a
--- /dev/null
+++ b/Misc/NEWS.d/next/Library/2024-11-09-15-59-51.gh-issue-126624.bN53Va.rst
@@ -0,0 +1,2 @@
+Expose error code :data:`~xml.parsers.expat.errors.XML_ERROR_NOT_STARTED`
+of Expat >=2.6.4 in :mod:`xml.parsers.expat.errors`.
diff --git a/Modules/pyexpat.c b/Modules/pyexpat.c
index 5665ed2..e15a1c5 100644
--- a/Modules/pyexpat.c
+++ b/Modules/pyexpat.c
@@ -1860,6 +1860,8 @@ MODULE_INITFUNC(void)
     MYCONST(XML_ERROR_ABORTED);
     MYCONST(XML_ERROR_FINISHED);
     MYCONST(XML_ERROR_SUSPEND_PE);
+     /* Added in 2.6.4. */
+    MYCONST(XML_ERROR_NOT_STARTED);
 
     if (PyModule_AddStringConstant(errors_module, "__doc__",
                                    "Constants used to describe "
-- 
2.50.1

