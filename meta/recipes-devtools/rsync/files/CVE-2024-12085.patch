From cf620065502f065d4ea44f5df4f81295a738aa21 Mon Sep 17 00:00:00 2001
From: Andrew Tridgell <andrew@tridgell.net>
Date: Thu, 14 Nov 2024 09:57:08 +1100
Subject: [PATCH] prevent information leak off the stack

prevent leak of uninitialised stack data in hash_search

Upstream-Status: Backport [import from ubuntu https://git.launchpad.net/ubuntu/+source/rsync/tree/debian/patches/CVE-2024-12085/0001-prevent-information-leak-off-the-stack.patch?h=ubuntu/focal-security
Upstream commit https://git.samba.org/?p=rsync.git;a=commit;h=589b0691e59f761ccb05ddb8e1124991440db2c7]
CVE: CVE-2024-12085
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 match.c | 3 +++
 1 file changed, 3 insertions(+)

Index: rsync-3.1.3/match.c
===================================================================
--- rsync-3.1.3.orig/match.c
+++ rsync-3.1.3/match.c
@@ -150,6 +150,9 @@ static void hash_search(int f,struct sum
 	int more;
 	schar *map;
 
+	// prevent possible memory leaks
+	memset(sum2, 0, sizeof sum2);
+
 	/* want_i is used to encourage adjacent matches, allowing the RLL
 	 * coding of the output to work more efficiently. */
 	want_i = 0;
