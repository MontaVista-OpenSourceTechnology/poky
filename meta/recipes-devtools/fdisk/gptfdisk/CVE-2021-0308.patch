From eb2a55c3d95b5b54fa9b7d8e2b3b653cd0a16558 Mon Sep 17 00:00:00 2001
From: Vijay Anusuri <vanusuri@mvista.com>
Date: Mon, 19 Jan 2026 11:13:55 +0000
Subject: [PATCH] Fix bug that could cause crash if a badly-formatted MBR disk was read.

Upstream-Status: Backport [https://sourceforge.net/p/gptfdisk/code/ci/f523bbc0c2437fe259aa3aff5e819e24101aee29]
CVE: CVE-2021-0308
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 basicmbr.cc | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/basicmbr.cc b/basicmbr.cc
index dd48706..c266e39 100644
--- a/basicmbr.cc
+++ b/basicmbr.cc
@@ -290,7 +290,8 @@ int BasicMBRData::ReadLogicalParts(uint64_t extendedStart, int partNum) {
          if (EbrLocations[i] == offset) { // already read this one; infinite logical partition loop!
             cerr << "Logical partition infinite loop detected! This is being corrected.\n";
             allOK = -1;
-            partNum -= 1;
+            if (partNum > 0) //don't go negative
+               partNum -= 1;
          } // if
       } // for
       EbrLocations[partNum] = offset;
-- 
2.24.4

