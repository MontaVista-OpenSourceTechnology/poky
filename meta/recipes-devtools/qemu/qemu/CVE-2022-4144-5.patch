From a1afe25b94df5833ff9fe355b42a529a00111477 Mon Sep 17 00:00:00 2001
From: Vijay Anusuri <vanusuri@mvista.com>
Date: Mon, 9 Jan 2023 13:21:58 +0000
Subject: [PATCH] hw/display/qxl: Assert memory slot fits in preallocated MemoryRegion

Signed-off-by: Philippe Mathieu-Daud√© <philmd@linaro.org>
Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>
Message-Id: <20221128202741.4945-6-philmd@linaro.org>

Upstream-Status: Backport [https://gitlab.com/qemu-project/qemu/-/commit/86fdb058]
CVE: CVE-2022-4144
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 hw/display/qxl.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/hw/display/qxl.c b/hw/display/qxl.c
index 46d82d0a..a029f5ef 100644
--- a/hw/display/qxl.c
+++ b/hw/display/qxl.c
@@ -1407,6 +1407,7 @@ static int qxl_add_memslot(PCIQXLDevice *d, uint32_t slot_id, uint64_t delta,
         qxl_set_guest_bug(d, "%s: pci_region = %d", __func__, pci_region);
         return 1;
     }
+    assert(guest_end - pci_start <= memory_region_size(mr));
 
     virt_start = (intptr_t)memory_region_get_ram_ptr(mr);
     memslot.slot_id = slot_id;
-- 
2.18.2

