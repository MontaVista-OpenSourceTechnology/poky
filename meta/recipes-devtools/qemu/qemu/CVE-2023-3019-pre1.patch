
Upstream-Status: Backport [import from ubuntu https://git.launchpad.net/ubuntu/+source/qemu/tree/debian/patches/CVE-2023-3019-pre1.patch?h=ubuntu/focal-security
Upstream commit https://gitlab.com/qemu-project/qemu/-/commit/a2e1753b8054344f32cf94f31c6399a58794a380]
CVE: CVE-2023-3019 #Dependency Patch
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>

Index: qemu-4.2/include/hw/qdev-core.h
===================================================================
--- qemu-4.2.orig/include/hw/qdev-core.h
+++ qemu-4.2/include/hw/qdev-core.h
@@ -138,6 +138,10 @@ struct NamedGPIOList {
     QLIST_ENTRY(NamedGPIOList) node;
 };
 
+typedef struct {
+    bool engaged_in_io;
+} MemReentrancyGuard;
+
 /**
  * DeviceState:
  * @realized: Indicates whether the device has been fully constructed.
@@ -163,6 +167,7 @@ struct DeviceState {
     int num_child_bus;
     int instance_id_alias;
     int alias_required_for_version;
+    MemReentrancyGuard mem_reentrancy_guard;
 };
 
 struct DeviceListener {
Index: qemu-4.2/include/net/net.h
===================================================================
--- qemu-4.2.orig/include/net/net.h
+++ qemu-4.2/include/net/net.h
@@ -4,6 +4,7 @@
 #include "qemu/queue.h"
 #include "qapi/qapi-types-net.h"
 #include "net/queue.h"
+#include "include/hw/qdev-core.h"
 
 #define MAC_FMT "%02X:%02X:%02X:%02X:%02X:%02X"
 #define MAC_ARG(x) ((uint8_t *)(x))[0], ((uint8_t *)(x))[1], \
