From be9536ecdaa3343b91eb47374aeaa84fd56aca7c Mon Sep 17 00:00:00 2001
From: Vijay Anusuri <vanusuri@mvista.com>
Date: Fri, 23 Dec 2022 13:02:07 +0000
Subject: [PATCH] Fixing tests adding protocol.file.allow to handle with CVE-2022-39253 limitation changes

Author: leo.barbosa@canonical.com

Upstream-Status: Backport [https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/git/1:2.17.1-1ubuntu0.13/git_2.17.1-1ubuntu0.13.debian.tar.xz]
CVE: CVE-2022-39253
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 t/t7410-submodule-checkout-to.sh | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/t/t7410-submodule-checkout-to.sh b/t/t7410-submodule-checkout-to.sh
index 1acef32..147222a 100755
--- a/t/t7410-submodule-checkout-to.sh
+++ b/t/t7410-submodule-checkout-to.sh
@@ -7,7 +7,8 @@ test_description='Combination of submodules and multiple workdirs'
 base_path=$(pwd -P)
 
 test_expect_success 'setup: make origin' \
-    'mkdir -p origin/sub && ( cd origin/sub && git init &&
+    'test_config_global protocol.file.allow always &&
+    mkdir -p origin/sub && ( cd origin/sub && git init &&
 	echo file1 >file1 &&
 	git add file1 &&
 	git commit -m file1 ) &&
@@ -24,7 +25,8 @@ test_expect_success 'setup: make origin' \
 	git commit -m "sub updated" )'
 
 test_expect_success 'setup: clone' \
-    'mkdir clone && ( cd clone &&
+    'test_config_global protocol.file.allow always &&
+    mkdir clone && ( cd clone &&
 	git clone --recursive "$base_path/origin/main")'
 
 rev1_hash_main=$(git --git-dir=origin/main/.git show --pretty=format:%h -q "HEAD~1")
@@ -39,7 +41,8 @@ test_expect_failure 'can see submodule diffs just after checkout' \
     '(cd default_checkout/main && git diff --submodule master"^!" | grep "file1 updated")'
 
 test_expect_success 'checkout main and initialize independed clones' \
-    'mkdir fully_cloned_submodule &&
+    'test_config_global protocol.file.allow always &&
+    mkdir fully_cloned_submodule &&
     (cd clone/main &&
 	git worktree add "$base_path/fully_cloned_submodule/main" "$rev1_hash_main") &&
     (cd fully_cloned_submodule/main && git submodule update)'
-- 
2.18.2

