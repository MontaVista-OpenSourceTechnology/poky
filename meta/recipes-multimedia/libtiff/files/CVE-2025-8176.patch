From ecc4ddbf1f0fed7957d1e20361e37f01907898e0 Mon Sep 17 00:00:00 2001 
From: Lee Howard <faxguy@howardsilvan.com> 
Date: Sat, 24 May 2025 21:38:09 -0700 
Subject: [PATCH] conflict resolution

Upstream-Status: Backport from [https://gitlab.com/libtiff/libtiff/-/commit/fe10872e53efba9cc36c66ac4ab3b41a839d5172]
CVE: CVE-2025-8176
Signed-off-by: Milan Satpathy <msatpathy@mvista.com>
---
 tools/tiffmedian.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/tools/tiffmedian.c b/tools/tiffmedian.c
index bd0d156..cc75291 100644
--- a/tools/tiffmedian.c
+++ b/tools/tiffmedian.c
@@ -368,7 +368,10 @@ get_histogram(TIFF* in, Colorbox* box)
 	}
 	for (i = 0; i < imagelength; i++) {
 		if (TIFFReadScanline(in, inputline, i, 0) <= 0)
-			break;
+        {
+            fprintf(stderr, "Error reading scanline\n");
+            exit(EXIT_FAILURE);
+        }
 		inptr = inputline;
 		for (j = imagewidth; j-- > 0;) {
 			red = (*inptr++) & 0xff >> COLOR_SHIFT;
-- 
2.34.1

