From e64336a4db6f5b66bda05bf596119be2fba2dd47 Mon Sep 17 00:00:00 2001
From: Siddharth Doshi <sdoshi@mvista.com>
Date: Thu, 21 Oct 2021 05:52:32 +0000
Subject: [PATCH] CVE-2020-19143

Upstream-Status: https://gitlab.com/libtiff/libtiff/-/commit/54ce8c522078cd0f39861df71db848648ec28ade

Signed-off-by: Siddharth Doshi <sdoshi@mvista.com>
---
 libtiff/tif_dirinfo.c | 4 ----
 tools/tiffcp.c        | 3 ++-
 2 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/libtiff/tif_dirinfo.c b/libtiff/tif_dirinfo.c
index e1f6b23..52d53d4 100644
--- a/libtiff/tif_dirinfo.c
+++ b/libtiff/tif_dirinfo.c
@@ -1062,10 +1062,6 @@ _TIFFCheckFieldIsValidForCodec(TIFF *tif, ttag_t tag)
 		if (tag == TIFFTAG_LERC_PARAMETERS)
 		    return 1;
 		break;
-		  case COMPRESSION_WEBP:
-		if (tag == TIFFTAG_PREDICTOR)
-				return 1;
-		break;
 	}
 	return 0;
 }
diff --git a/tools/tiffcp.c b/tools/tiffcp.c
index 84d8148..1b623c7 100644
--- a/tools/tiffcp.c
+++ b/tools/tiffcp.c
@@ -741,11 +741,12 @@ tiffcp(TIFF* in, TIFF* out)
 		case COMPRESSION_DEFLATE:
                 case COMPRESSION_LZMA:
                 case COMPRESSION_ZSTD:
-								case COMPRESSION_WEBP:
 			if (predictor != (uint16)-1)
 				TIFFSetField(out, TIFFTAG_PREDICTOR, predictor);
 			else
 				CopyField(TIFFTAG_PREDICTOR, predictor);
+			/*fallthrough*/
+		case COMPRESSION_WEBP:
 			if (preset != -1) {
                                 if (compression == COMPRESSION_ADOBE_DEFLATE
                                          || compression == COMPRESSION_DEFLATE)
-- 
2.24.3

