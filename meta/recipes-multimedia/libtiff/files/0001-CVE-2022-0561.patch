From ba87db18061ccdd559ec966b66660f36dfc10431 Mon Sep 17 00:00:00 2001
From: Vijay Anusuri <vanusuri@mvista.com>
Date: Fri, 9 Sep 2022 05:48:33 +0000
Subject: [PATCH] CVE-2022-0561

TIFFFetchStripThing(): avoid calling memcpy() with a null source pointer and size of zero (fixes #362)

Upstream-Status: Backport from https://gitlab.com/freedesktop-sdk/mirrors/gitlab/libtiff/libtiff/-/commit/eecb0712f4c3a5b449f70c57988260a667ddbdef
CVE: CVE-2022-0561
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 libtiff/tif_dirread.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/libtiff/tif_dirread.c b/libtiff/tif_dirread.c
index 347b7ad..f6490bf 100644
--- a/libtiff/tif_dirread.c
+++ b/libtiff/tif_dirread.c
@@ -5516,8 +5516,9 @@ TIFFFetchStripThing(TIFF* tif, TIFFDirEntry* dir, uint32 nstrips, uint64** lpp)
 		}
 		if (dir->tdir_count<(uint64)nstrips)
 		{
-			_TIFFmemcpy(resizeddata,data,(uint32)dir->tdir_count*sizeof(uint64));
-			_TIFFmemset(resizeddata+(uint32)dir->tdir_count,0,(nstrips-(uint32)dir->tdir_count)*sizeof(uint64));
+                        if( dir->tdir_count )
+                                  _TIFFmemcpy(resizeddata,data, (uint32)dir->tdir_count * sizeof(uint64));
+                        _TIFFmemset(resizeddata+(uint32)dir->tdir_count, 0, (nstrips - (uint32)dir->tdir_count) * sizeof(uint64));
 		}
 		else
 			_TIFFmemcpy(resizeddata,data,nstrips*sizeof(uint64));
-- 
2.18.2

