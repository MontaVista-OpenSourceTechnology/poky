From 14a5088edeed135e4ba060af1a2af409a9d9c1f8 Mon Sep 17 00:00:00 2001
From: xiaoxiaoafeifei <lliangliang2007@163.com>
Date: Fri, 21 Apr 2023 13:01:34 +0000
Subject: countInkNamesString(): fix `UndefinedBehaviorSanitizer`: applying
 zero offset to null pointer

Upstream-Status: Backport [import from debian http://security.debian.org/debian-security/pool/updates/main/t/tiff/tiff_4.1.0+git191117-2~deb10u8.debian.tar.xz
Upstream-Commit: https://gitlab.com/libtiff/libtiff/-/commit/9bd48f0dbd64fb94dc2b5b05238fde0bfdd4ff3f]
CVE: CVE-2023-2908
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 libtiff/tif_dir.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/libtiff/tif_dir.c b/libtiff/tif_dir.c
index 9d8267a0..4452efcd 100644
--- a/libtiff/tif_dir.c
+++ b/libtiff/tif_dir.c
@@ -145,10 +145,10 @@ static uint16
 countInkNamesString(TIFF *tif, uint32 slen, const char *s)
 {
 	uint16 i = 0;
-	const char *ep = s + slen;
-	const char *cp = s;
 
 	if (slen > 0) {
+		const char *ep = s + slen;
+		const char *cp = s;
 		do {
 			for (; cp < ep && *cp != '\0'; cp++) {}
 			if (cp >= ep)
-- 
2.30.2

