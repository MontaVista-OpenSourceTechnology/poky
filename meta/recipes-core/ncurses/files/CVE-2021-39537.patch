From 69676bf0ae02ea3f212888e49ecd8daa0a4d1274 Mon Sep 17 00:00:00 2001
From: Vijay Anusuri <vanusuri@mvista.com>
Date: Mon, 4 Apr 2022 10:48:04 +0000
Subject: [PATCH] CVE-2021-39537

ncurses: heap-based buffer overflow in _nc_captoinfo() in captoinfo.c

Upstream-Status: Backport from https://github.com/mirror/ncurses/commit/790a85dbd4a81d5f5d8dd02a44d84f01512ef443#diff-7e95c7bc5f213e9be438e69a9d5d0f261a14952bcbd692f7b9014217b8047340
CVE: CVE-2021-39537
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>

---
 ncurses/tinfo/captoinfo.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/ncurses/tinfo/captoinfo.c b/ncurses/tinfo/captoinfo.c
index e552a8b..362b1ba 100644
--- a/ncurses/tinfo/captoinfo.c
+++ b/ncurses/tinfo/captoinfo.c
@@ -215,12 +215,15 @@ cvtchar(register const char *sp)
 	}
 	break;
     case '^':
+	len = 2;
 	c = UChar(*++sp);
-	if (c == '?')
+	if (c == '?') {
 	    c = 127;
-	else
+	} else if (c == '\0') {
+	    len = 1;
+	} else {
 	    c &= 0x1f;
-	len = 2;
+	}
 	break;
     default:
 	c = UChar(*sp);
-- 
2.20.1

