From abf768e86fa18bcc974db41a2d60b8d06f52bd86 Mon Sep 17 00:00:00 2001
From: Vijay Anusuri <vanusuri@mvista.com>
Date: Wed, 17 Aug 2022 08:46:27 +0000
Subject: [PATCH] CVE-2021-39537

Fix for CVE-2021-39537 from upstream:
https://github.com/ThomasDickey/ncurses-snapshots/commit/63ca9e061f4644795d6f3f559557f3e1ed8c738b#diff-7e95c7bc5f213e9be438e69a9d5d0f261a14952bcbd692f7b9014217b8047340

Upstream-Status: Backport [http://cvsweb.netbsd.org/bsdweb.cgi/pkgsrc/devel/ncurses/patches/Attic/patch-ncurses_tinfo_captoinfo.c?rev=1.1&content-type=text/x-cvsweb-markup]
CVE: CVE-2021-39537
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 ncurses/tinfo/captoinfo.c | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/ncurses/tinfo/captoinfo.c b/ncurses/tinfo/captoinfo.c
index e552a8b6..ebb07a51 100644
--- a/ncurses/tinfo/captoinfo.c
+++ b/ncurses/tinfo/captoinfo.c
@@ -215,12 +215,15 @@ cvtchar(register const char *sp)
 	}
 	break;
     case '^':
+        len = 2;
 	c = UChar(*++sp);
-	if (c == '?')
+	  if (c == '?') {
 	    c = 127;
-	else
+          } else if (c == '\0') {
+              len = 1;
+          } else {
 	    c &= 0x1f;
-	len = 2;
+        }
 	break;
     default:
 	c = UChar(*sp);
-- 
2.18.2

