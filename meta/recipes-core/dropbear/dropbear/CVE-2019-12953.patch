commit 8b4f60a7a113f4e9ae801dea88606f2663728f03
Author: Matt Johnston <matt@ucc.asn.au>
Date:   Thu Mar 21 00:09:07 2019 +0800

    limit password length to 100

This fixes CVE-2019-12953.

Signed-off-by: Javier Campos <jcampos@mvista.com>

Index: dropbear-2017.75/svr-authpasswd.c
===================================================================
--- dropbear-2017.75.orig/svr-authpasswd.c
+++ dropbear-2017.75/svr-authpasswd.c
@@ -65,7 +65,7 @@ void svr_auth_password(int valid_user) {
 	}
 
 	password = buf_getstring(ses.payload, &passwordlen);
-	if (valid_user) {
+	if (valid_user && passwordlen <= DROPBEAR_MAX_PASSWORD_LEN) {
 		/* the first bytes of passwdcrypt are the salt */
 		passwdcrypt = ses.authstate.pw_passwd;
 		testcrypt = crypt(password, passwdcrypt);
@@ -79,6 +79,15 @@ void svr_auth_password(int valid_user) {
 		send_msg_userauth_failure(0, 1);
 		return;
 	}
+
+	if (passwordlen > DROPBEAR_MAX_PASSWORD_LEN) {
+		dropbear_log(LOG_WARNING,
+				"Too-long password attempt for '%s' from %s",
+				ses.authstate.pw_name,
+				svr_ses.addrstring);
+		send_msg_userauth_failure(0, 1);
+		return;
+	}
 
 	if (testcrypt == NULL) {
 		/* crypt() with an invalid salt like "!!" */
Index: dropbear-2017.75/sysoptions.h
===================================================================
--- dropbear-2017.75.orig/sysoptions.h
+++ dropbear-2017.75/sysoptions.h
@@ -74,6 +74,8 @@
 #define DROPBEAR_SIGNKEY_VERIFY
 #endif
 
+#define DROPBEAR_MAX_PASSWORD_LEN 100
+
 #define SHA1_HASH_SIZE 20
 #define MD5_HASH_SIZE 16
 #define MAX_HASH_SIZE 64 /* sha512 */
