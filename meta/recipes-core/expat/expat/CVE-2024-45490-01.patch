From 5c1a31642e243f4870c0bd1f2afc7597976521bf Mon Sep 17 00:00:00 2001
From: Sebastian Pipping <sebastian@pipping.org>
Date: Mon, 19 Aug 2024 22:26:07 +0200
Subject: lib: Reject negative len for XML_ParseBuffer

Reported by TaiYou

Origin: https://github.com/libexpat/libexpat/commit/5c1a31642e243f4870c0bd1f2afc7597976521bf
Bug: https://github.com/libexpat/libexpat/issues/887
Bug: https://github.com/libexpat/libexpat/pull/890
Bug-Debian: https://security-tracker.debian.org/tracker/CVE-2024-45490
Bug-Debian: https://bugs.debian.org/1080149

Upstream-Status: Backport [https://github.com/libexpat/libexpat/commit/5c1a31642e243f4870c0bd1f2afc7597976521bf]
CVE: CVE-2024-45490
Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 lib/xmlparse.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/lib/xmlparse.c b/lib/xmlparse.c
index 1b3c5950..442c7663 100644
--- a/lib/xmlparse.c
+++ b/lib/xmlparse.c
@@ -2065,6 +2065,12 @@ XML_ParseBuffer(XML_Parser parser, int len, int isFinal) {
 
   if (parser == NULL)
     return XML_STATUS_ERROR;
+
+  if (len < 0) {
+    parser->m_errorCode = XML_ERROR_INVALID_ARGUMENT;
+    return XML_STATUS_ERROR;
+  }
+
   switch (parser->m_parsingStatus.parsing) {
   case XML_SUSPENDED:
     parser->m_errorCode = XML_ERROR_SUSPENDED;
-- 
2.50.1

