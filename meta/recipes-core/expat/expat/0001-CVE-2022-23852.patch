From db041786cf3f3071394aaf3a266a481ad252a69e Mon Sep 17 00:00:00 2001
From: Hitendra Prajapati <hprajapati@mvista.com>
Date: Wed, 13 Apr 2022 11:13:50 +0530
Subject: [PATCH] CVE-2022-23852

Upstream-Status: Backport from https://github.com/libexpat/libexpat/commit/847a645152f5ebc10ac63b74b604d0c1a79fae40

Signed-off-by: Steve Sakoman <steve@sakoman.com>

Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 lib/xmlparse.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/lib/xmlparse.c b/lib/xmlparse.c
index 9edd3eb..56abf98 100644
--- a/lib/xmlparse.c
+++ b/lib/xmlparse.c
@@ -2115,6 +2115,11 @@ XML_GetBuffer(XML_Parser parser, int len)
     keep = (int)(bufferPtr - buffer);
     if (keep > XML_CONTEXT_BYTES)
       keep = XML_CONTEXT_BYTES;
+    /* Detect and prevent integer overflow */
+    if (keep > INT_MAX - neededSize) {
+      parser->m_errorCode = XML_ERROR_NO_MEMORY;
+      return NULL;
+    }
     neededSize += keep;
 #endif  /* defined XML_CONTEXT_BYTES */
     if (neededSize  <= bufferLim - buffer) {
-- 
2.25.1

