From 3b4cc1437b51fcc0b08da8cc3f5d1175eed25eb1 Mon Sep 17 00:00:00 2001
From: Michal Sekletar <msekleta@redhat.com>
Date: Wed, 20 Dec 2023 16:44:14 +0100
Subject: [PATCH] resolved: actually check authenticated flag of SOA
 transaction

Fixes #25676

Upstream-Status: Backport [https://repo.almalinux.org/vault/8/BaseOS/Source/Packages/systemd-239-82.el8.src.rpm & https://github.com/systemd/systemd/commit/3b4cc1437b51fcc0b08da8cc3f5d1175eed25eb1]
CVE: CVE-2023-7008
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 src/resolve/resolved-dns-transaction.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/resolve/resolved-dns-transaction.c b/src/resolve/resolved-dns-transaction.c
index ca98ba188a..65ec0284bf 100644
--- a/src/resolve/resolved-dns-transaction.c
+++ b/src/resolve/resolved-dns-transaction.c
@@ -2463,7 +2463,7 @@ static int dns_transaction_requires_rrsig(DnsTransaction *t, DnsResourceRecord *
                         if (r == 0)
                                 continue;
 
-                        return t->answer_authenticated;
+                        return dt->answer_authenticated;
                 }
 
                 return true;
@@ -2493,7 +2493,7 @@ static int dns_transaction_requires_rrsig(DnsTransaction *t, DnsResourceRecord *
                          * RR for us. This means we are not at a zone cut. In
                          * this case, we require authentication if the SOA
                          * lookup was authenticated too. */
-                        return t->answer_authenticated;
+                        return dt->answer_authenticated;
                 }
 
                 return true;
-- 
2.24.4

