From 11fb2bfdf7d06703ab6f028fcbc3b582efba5d14 Mon Sep 17 00:00:00 2001
From: Vivek Kumbhar <vkumbhar@mvista.com>
Date: Tue, 9 May 2023 10:57:57 +0000
Subject: [PATCH] CVE-2023-2004-pre1.patch

---
 include/freetype/internal/ftcalc.h | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/include/freetype/internal/ftcalc.h b/include/freetype/internal/ftcalc.h
index c9ac9d8..97035c2 100644
--- a/include/freetype/internal/ftcalc.h
+++ b/include/freetype/internal/ftcalc.h
@@ -408,7 +408,17 @@ FT_BEGIN_HEADER

 #define ROUND_F26DOT6( x )     ( x >= 0 ? (    ( (x) + 32 ) & -64 )     \
                                         : ( -( ( 32 - (x) ) & -64 ) ) )
-
+  /*
+   * The following macros have two purposes.
+   *
+   * - Tag places where overflow is expected and harmless.
+   *
+   * - Avoid run-time sanitizer errors.
+   *
+   * Use with care!
+   */
+#define ADD_INT( a, b )                           \
+          (FT_Int)( (FT_UInt)(a) + (FT_UInt)(b) )

 FT_END_HEADER

--
2.18.2
