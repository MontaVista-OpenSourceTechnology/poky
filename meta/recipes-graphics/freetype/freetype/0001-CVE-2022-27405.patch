From f83a321fea8a1d5f8193ee08508fbe15f4cfdc62 Mon Sep 17 00:00:00 2001
From: Hitendra Prajapati <hprajapati@mvista.com>
Date: Tue, 3 May 2022 09:52:10 +0530
Subject: [PATCH] CVE-2022-27405

Upstream-Status: Backport from https://gitlab.freedesktop.org/freetype/freetype/-/commit/22a0cccb4d9d002f33c1ba7a4b36812c7d4f46b5

Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 src/base/ftobjs.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/base/ftobjs.c b/src/base/ftobjs.c
index e301f8f..9c0e5ad 100644
--- a/src/base/ftobjs.c
+++ b/src/base/ftobjs.c
@@ -2389,6 +2389,15 @@
 #endif
 
 
+    /* only use lower 31 bits together with sign bit */
+    if ( face_index > 0 )
+      face_index &= 0x7FFFFFFFL;
+    else
+    {
+      face_index &= 0x7FFFFFFFL;
+      face_index  = -face_index;
+    }
+
 #ifdef FT_DEBUG_LEVEL_TRACE
     FT_TRACE3(( "FT_Open_Face: " ));
     if ( face_index < 0 )
-- 
2.25.1

