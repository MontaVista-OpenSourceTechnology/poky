From 3a40f6b897b4443881b7107b97392ea3da915b6d Mon Sep 17 00:00:00 2001
From: Hitendra Prajapati <hprajapati@mvista.com>
Date: Fri, 25 Mar 2022 10:41:31 +0530
Subject: [PATCH] CVE-2021-4011

Upstream-Status: Backport from https://gitlab.freedesktop.org/xorg/xserver/-/commit/e56f61c79fc3cee26d83cda0f84ae56d5979f768

Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 record/record.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/record/record.c b/record/record.c
index a3df5a3..4f5b188 100644
--- a/record/record.c
+++ b/record/record.c
@@ -2514,9 +2514,9 @@ SwapCreateRegister(ClientPtr client, xRecordRegisterClientsReq * stuff)
         swapl(pClientID);
     }
     if (stuff->nRanges >
-        client->req_len - bytes_to_int32(sz_xRecordRegisterClientsReq)
-        - stuff->nClients)
-        return BadLength;
+        (client->req_len - bytes_to_int32(sz_xRecordRegisterClientsReq)
+        - stuff->nClients) / bytes_to_int32(sz_xRecordRange))
+	return BadLength;
     RecordSwapRanges((xRecordRange *) pClientID, stuff->nRanges);
     return Success;
 }                               /* SwapCreateRegister */
-- 
2.25.1

