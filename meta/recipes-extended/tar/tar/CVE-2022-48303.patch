From 3da78400eafcccb97e2f2fd4b227ea40d794ede8 Mon Sep 17 00:00:00 2001
From: Sergey Poznyakoff <gray@gnu.org>
Date: Sat, 11 Feb 2023 11:57:39 +0200
Subject: Fix boundary checking in base-256 decoder

* src/list.c (from_header): Base-256 encoding is at least 2 bytes
long.

Upstream-Status: Backport [https://git.savannah.gnu.org/cgit/tar.git/commit/?id=3da78400eafcccb97e2f2fd4b227ea40d794ede8]
CVE: CVE-2022-48303
Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
---
 src/list.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

Index: tar-1.29b/src/list.c
===================================================================
--- tar-1.29b.orig/src/list.c
+++ tar-1.29b/src/list.c
@@ -874,8 +874,9 @@ from_header (char const *where0, size_t
 	  where++;
 	}
     }
-  else if (*where == '\200' /* positive base-256 */
-	   || *where == '\377' /* negative base-256 */)
+  else if (where <= lim - 2
+	   && (*where == '\200' /* positive base-256 */
+	       || *where == '\377' /* negative base-256 */))
     {
       /* Parse base-256 output.  A nonnegative number N is
 	 represented as (256**DIGS)/2 + N; a negative number -N is
