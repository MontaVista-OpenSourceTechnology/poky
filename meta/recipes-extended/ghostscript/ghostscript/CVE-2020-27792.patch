From 4b2f0f5bec331491310433524920d2d8d1fc8802 Mon Sep 17 00:00:00 2001
From: Hitendra Prajapati <hprajapati@mvista.com>
Date: Fri, 9 Sep 2022 16:08:29 +0530
Subject: [PATCH] CVE-2020-27792

Upstream-Status: Backport [https://git.ghostscript.com/?p=ghostpdl.git;a=commit;h=4f6bc662909ab79e8fbe9822afb36e8a0eafc2b7]
CVE: CVE-2020-27792
Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 devices/gdevlp8k.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/devices/gdevlp8k.c b/devices/gdevlp8k.c
index a3964db..b46a402 100644
--- a/devices/gdevlp8k.c
+++ b/devices/gdevlp8k.c
@@ -185,7 +185,10 @@ lp8000_print_page(gx_device_printer *pdev, FILE *prn_stream)
         unsigned int report_size;
 
         byte *buf1 = (byte *)gs_malloc(pdev->memory, in_size, 1, "lp8000_print_page(buf1)");
-        byte *buf2 = (byte *)gs_malloc(pdev->memory, in_size, 1, "lp8000_print_page(buf2)");
+
+        /* Worst case for rle compression below is 3 bytes for each 2 bytes of
+        input, with extra final byte. */
+        byte *buf2 = (byte *)gs_malloc(pdev->memory, in_size * 3 / 2 + 2, 1, "lp8000_print_page(buf2)");
         byte *in = buf1;
         byte *out = buf2;
 
-- 
2.25.1

