From 9302d2ebeda080dddbe625ac5ec0dd47cd99b85c Mon Sep 17 00:00:00 2001
From: Hitendra Prajapati <hprajapati@mvista.com>
Date: Fri, 6 May 2022 09:59:24 +0530
Subject: [PATCH] CVE-2019-25059

Upstream-Status: Backport from http://git.ghostscript.com/?p=ghostpdl.git;a=commit;h=430e219ea17a2650577d70021399c4ead05869e0

Signed-off-by: Hitendra Prajapati <hprajapati@mvista.com>
---
 Resource/Init/gs_fonts.ps | 6 +++---
 Resource/Init/gs_ttf.ps   | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/Resource/Init/gs_fonts.ps b/Resource/Init/gs_fonts.ps
index a3da615..6c0ab1b 100644
--- a/Resource/Init/gs_fonts.ps
+++ b/Resource/Init/gs_fonts.ps
@@ -509,7 +509,7 @@ buildfontdict 3 /.buildfont3 cvx put
       } if
       readonly          % stack: name fontdict
   } stopped { $error /command get /invalidfont signalerror } if
-} bind def
+} bind executeonly odef
 /definefont
  { dup rcheck not {
       /definefont cvx /invalidaccess signalerror
@@ -527,7 +527,7 @@ buildfontdict 3 /.buildfont3 cvx put
                 % If the font originated as a resource, register it.
    currentfile .currentresourcefile eq { dup .registerfont } if
    readonly
- } odef
+ } .bind executeonly odef
 
 % Define a procedure for defining aliased fonts.
 % We use this only for explicitly aliased fonts, not substituted fonts:
@@ -577,7 +577,7 @@ buildfontdict 3 /.buildfont3 cvx put
     }
    ifelse
    exch .setglobal
- } odef         % so findfont will bind it
+ } bind executeonly odef         % so findfont will bind it
 
 % Define .loadfontfile for loading a font.  If we recognize Type 1 and/or
 % TrueType fonts, gs_type1.ps and/or gs_ttf.ps will redefine this.
diff --git a/Resource/Init/gs_ttf.ps b/Resource/Init/gs_ttf.ps
index ebacc6b..ee61a2e 100644
--- a/Resource/Init/gs_ttf.ps
+++ b/Resource/Init/gs_ttf.ps
@@ -1984,4 +1984,4 @@ currentdict /postalias undef
   dup /FontName font_name put        % replace any definition of /FontName
   end end
  .completefont
-} bind def
+} bind executeonly def
-- 
2.25.1

